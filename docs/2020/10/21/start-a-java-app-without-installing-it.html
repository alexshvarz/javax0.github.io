<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Start a Java app without installing it | Java Deep, mostly Java</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Start a Java app without installing it" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This article describes how you can use JShell to download and execute a Java application. It will eliminate the need for the installation of the application." />
<meta property="og:description" content="This article describes how you can use JShell to download and execute a Java application. It will eliminate the need for the installation of the application." />
<link rel="canonical" href="https://javax0.github.io/2020/10/21/start-a-java-app-without-installing-it.html" />
<meta property="og:url" content="https://javax0.github.io/2020/10/21/start-a-java-app-without-installing-it.html" />
<meta property="og:site_name" content="Java Deep, mostly Java" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-21T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Start a Java app without installing it" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-10-21T00:00:00+02:00","datePublished":"2020-10-21T00:00:00+02:00","description":"This article describes how you can use JShell to download and execute a Java application. It will eliminate the need for the installation of the application.","headline":"Start a Java app without installing it","mainEntityOfPage":{"@type":"WebPage","@id":"https://javax0.github.io/2020/10/21/start-a-java-app-without-installing-it.html"},"url":"https://javax0.github.io/2020/10/21/start-a-java-app-without-installing-it.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://javax0.github.io/feed.xml" title="Java Deep, mostly Java" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Java Deep, mostly Java</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/">Java Deep</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Start a Java app without installing it</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-10-21T00:00:00+02:00" itemprop="datePublished">Oct 21, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="paragraph">
<p>This article describes how you can use JShell to download and execute a Java application. It will eliminate the need for the installation of the application.</p>
</div>
<div class="sect2">
<h3 id="1-1-do-not-install-just-run">1.1. Do not install, just run!</h3>
<div class="paragraph">
<p>The first obstacle that you have to overcome to make people use your app is the installation. You want people to use the app, try it out. To do that, they first have to install it. At least they have to download it and type in a command line to start it up. If your program is excellent and valuable for the users, they will use it after this step. They will see that it works and can do what it is supposed to do. Before the installation, however, this is a bit different. Users will install the program if they really, really need it. Installation is undoubtedly an entry threshold.</p>
</div>
</div>
<div class="sect2">
<h3 id="1-2-jamal-as-example">1.2. Jamal as Example</h3>
<div class="paragraph">
<p>My example is Jamal that you can download at <a href="https://github.com/verhas/jamal" class="bare">https://github.com/verhas/jamal</a>. I wrote the first version twenty years ago, and I named it Jamal. The name stands for Just Another Macro language, which I intended to be sarcastic. I thought it was sarcastic because it was so much more different than any other text macro applications. It seems the name was not interpreted as sarcastic but rather literally. Users saw it really as "just another" and it did not become widespread. A few people bothered to install it.
Now I have a Java version, which is even more versatile and powerful than the previous version. However, if you wanted to use it, you had to install it and start it up with a relatively complex <code>java -cp &#8230;&#8203;</code> command line. My first attempt to overcome this was to create a Maven plugin. A maven plugin executes without installing it. If you have installed Maven, all you need to run a plugin is a Maven command line. A kind of complex one, though. Or it would help if you had a <code>pom.xml</code>.</p>
</div>
<div class="paragraph">
<p>I also created the Maven plugin version because I used Jamal to maintain the <code>pom.xml</code> files with Jamal preprocessed. That way, as you can see in an earlier article, I can write</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">{dependencyManagement|{dependencies|
    {@for MODULE in (testsupport,api,core,tools,engine,extensions)={dependency :com.javax0.jamal:jamal-MODULE:{VERSION}}}
    {@for MODULE in (api,engine,params)={dependency :org.junit.jupiter:junit-jupiter-MODULE:5.2.0:test}}
    }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of a much longer and redundant XML fragment. This source, <code>pom.xml.jam</code> is then converted to <code>pom.xml</code>, and Maven runs fine.</p>
</div>
<div class="paragraph">
<p>The solution can still be better because many people do not use Maven. Jamal is not a Maven dependent tool.</p>
</div>
<div class="paragraph">
<p>I also use a different project to <code>*.md.jam</code> files to edit my next book. A book, as a project, does not require Maven. This book is not a Java book. I happen to have Maven on my machine, but the project does not need that.</p>
</div>
<div class="paragraph">
<p>There is no reason to require installed Maven as a precondition.</p>
</div>
<div class="paragraph">
<p>There is one precondition that I have to require, and that is an installed Java JDK. I cannot skip that because Jamal is written in Java.</p>
</div>
<div class="paragraph">
<p>You can also miss this precondition if you have docker, but then you need docker.</p>
</div>
<div class="paragraph">
<p>However, if you have the JDK installed (at least Java 9), you can quickly start a JShell. JShell executes the Java code from some input file that you specify on the command line. If you want to start Jamal, then the command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">jshell https://git.io/jamal</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command file is on GitHub, and JShell can download it from there. This command file downloads the JAR files needed to run Jamal, and then it starts Jamal in a separate process.</p>
</div>
<div class="paragraph">
<p>The actual script splits into separate parts, and the <code>jamal.jsh</code> content is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">/open scripts/version.jsh
/open scripts/jarfetcher.jsh
/open scripts/executor.jsh
/open scripts/optionloader.jsh
/open scripts/defaultoptions.jsh

download("01engine/jamal-engine")
download("02api/jamal-api")
download("03tools/jamal-tools")
download("04core/jamal-core")
download("08cmd/jamal-cmd")

loadOptions()

for(String jarUrl:extraJars){
    LOCAL_CACHE.mkdirs();
    downloadUrl(jarUrl,LOCAL_CACHE);
    }

execute()

/exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the JShell commands and the Java snippets are mixed. The script loads other scripts using the JShell <code>/open</code> command. These snippets define the method <code>download()</code>, <code>loadOption()</code> and <code>downloadUrl()</code>.</p>
</div>
<div class="paragraph">
<p>The script <code>version.jsh</code> defines the global variable <code>VERSION</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">String VERSION="1.2.0";</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="1-3-downloading-and-caching-the-program">1.3. Downloading and Caching the Program</h3>
<div class="paragraph">
<p>The next script, <code>jarfetcher.jsh</code> is a bit more complicated. As of now, it is 100 lines. If you want to look at the whole code, it is available on GitHub. You can calculate the URL from the argument of the <code>/open</code> statement and from the URL above used to start Jamal.</p>
</div>
<div class="paragraph">
<p>The core functionality implemented in this script is the one that downloads the JAR files. This is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">void downloadUrl(String urlString,File cacheRootDirectory) throws IOException {
    final URL url = new URL(urlString);
    File jar = new File(cacheRootDirectory.getAbsolutePath() + "/" + getFile(url));
    classPath.add(jar.getAbsolutePath());
    if (jar.exists()) {
        return;
    }
    System.out.println("downloading " + url);
    System.out.println("saving to file " + jar.getAbsolutePath());
    HttpURLConnection con = (HttpURLConnection) url.openConnection();
    con.setRequestMethod("GET");
    con.setConnectTimeout(CONNECT_TIMEOUT);
    con.setReadTimeout(READ_TIMEOUT);
    con.setInstanceFollowRedirects(true);
    final int status = con.getResponseCode();
    if (status != 200) {
        throw new IOException("GET url &amp;#039;" + url.toString() + "&amp;#039; returned " + status);
    }
    InputStream is = con.getInputStream();
    try (OutputStream outStream = new FileOutputStream(jar)) {
        byte[] buffer = new byte[8 * 1024];
        int bytesRead;
        while ((bytesRead = is.read(buffer)) != -1) {
            outStream.write(buffer, 0, bytesRead);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method caches the downloaded files into a directory. Environment variables can configure the directory. The default location is <code>~/.jamal/cache/.jar/</code>.</p>
</div>
<div class="paragraph">
<p>If the file exists, then it does not download it again. The code assumes that the files we are using are released JAR files that do not ever change. If this file was never downloaded before, it downloads the file and stores it in the cache directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="1-4-executing-the-macro-processor">1.4. Executing the macro processor</h3>
<div class="paragraph">
<p>When all the files are there, then the script executed Jamal. It is coded in the <code>executor.jsh</code>. The method <code>execute.jsh</code> contains the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">void execute() throws IOException, InterruptedException {
    ProcessBuilder builder = new ProcessBuilder();
    String sep = System.getProperty("path.separator");
    String cp = String.join(sep,classPath);
    List&lt;String&gt; arguments = new ArrayList&lt;&gt;();
    arguments.addAll(List.of("java", "-cp", cp, "javax0.jamal.cmd.JamalMain"));
    arguments.addAll(commandLineOptions.entrySet().stream().map(e -&gt; "" + e.getKey() + "=" + e.getValue()).collect( Collectors.toSet()));
    System.out.println("EXECUTING");
    for( String a : arguments){
        System.out.println(a);
    }
    builder.command(arguments.toArray(String[]::new))
        .directory(new File("."));
    Process process = builder.start();
    process.getInputStream().transferTo(System.out);
    int exitCode = process.waitFor();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this script is using the standard Java <code>ProcessBuilder</code> to create a new process and then executes Jamal in it.</p>
</div>
</div>
<div class="sect2">
<h3 id="1-5-extra-details">1.5. Extra details</h3>
<div class="paragraph">
<p>The actual operation is a bit more complex. Many options can control Jamal. In the Maven plugin version, these options are in the <code>pom.xml</code> file. The command-line version uses, eventually, command-line options. JShell does not handle command-line options that would pass to the executing JShell engine. There are some tricks, like using system properties or environment variables. I find those cumbersome and tricky to use. You usually execute Jamal using the same configuration in a single project. The best way is to have the options in a file. The Jamal startup JShell script reads the file <code>./jamal.options</code>. The file has a simple <code>key value</code> format. It can contain values for the command line options as keys and extra <code>jar</code> and <code>cp</code> keys. Jamal is extensible. Extra classes on the classpath may contain macro implementations in Java, and they are used from the text files. Every <code>jar</code> defines a URL from where a JAR file downloads. The <code>cp</code> key defines local files to be added to the classpath.</p>
</div>
<div class="paragraph">
<p>These files are project-specific; therefore, these will cache in the current working directory. The cache directory will be <code>./.jamal/cache/.jar/</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>jamal.options</code> file does not exist, then the script&#8217;s first execution will create. The auto-created file will contain the default values and also some documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="1-6-summary">1.6. Summary</h3>
<div class="paragraph">
<p>A Java application can start without downloading it first using JShell. The startup JShell script can be located on the net and downloaded on the fly. It can also fetch other scripts, and you can mix the Java snippets with JShell commands. I recommend having some caching strategy for the JAR files to avoid repetitive downloads. The JShell script can start your application in a new process. You cannot pass command line parameters to a JShell script, but you can use an options file or something else.</p>
</div>
<div class="paragraph">
<p>Happy scripting.</p>
</div>
</div>


<!-- Disqus comments section goes here (if comments are enabled) -->

<hr/>
<h1>Comments</h1>
<p>Please leave your comments using Disqus, or just press one of the happy faces.
If for any reason you do not want to leave a comment here, <a href="https://github.com/javax0/javax0.github.io/issues">you can still create a Github ticket</a>.</p>
<div class="comments">
    <div id="disqus_thread"></div>

    <script type="text/javascript">

        /* * * STOP! * * */
        /* You shouldn't need to edit ANYTHING below to get this working! */
        /* Instead, edit the key `disqus.shortname` in _config.yml */

        var disqus_config = function (){
            this.page.url = 'https://javax0.github.io/2020/10/21/start-a-java-app-without-installing-it.html';
            this.page.identifier = '/2020/10/21/start-a-java-app-without-installing-it.html';
        };

        (function() {
            var d = document, s = d.createElement('script');
            s.type = 'text/javascript'; s.async = true;
            s.src = 'https://javax0.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();

    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>




  </div><a class="u-url" href="/2020/10/21/start-a-java-app-without-installing-it.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java Deep, mostly Java</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java Deep, mostly Java</li><li><a class="u-email" href="mailto:peter@verhas.com">peter@verhas.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/verhas"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">verhas</span></a></li><li><a href="https://www.twitter.com/verhas"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">verhas</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>javax0 is a technical Java oriented blog. Whenever I find something interesting, in the mood and feel the power to publish it, you will get it here. Publications are usually released on Wednesday 15:00am GMT. Earlier posts of the blog were published on Javax0 Wordpress Site at https://javax0.wordpress.com</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
