<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Adding Diagrams to Markdown Documents | Java Deep, mostly Java</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Adding Diagrams to Markdown Documents" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A few weeks back, I wrote an article about how you can add Mermaid diagrams to your Markdown document. In this document, I will extend that technology and explain how you can add" />
<meta property="og:description" content="A few weeks back, I wrote an article about how you can add Mermaid diagrams to your Markdown document. In this document, I will extend that technology and explain how you can add" />
<link rel="canonical" href="https://javax0.github.io/2023/06/19/kroki-in-jamal.html" />
<meta property="og:url" content="https://javax0.github.io/2023/06/19/kroki-in-jamal.html" />
<meta property="og:site_name" content="Java Deep, mostly Java" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-19T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Adding Diagrams to Markdown Documents" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-19T00:00:00+02:00","datePublished":"2023-06-19T00:00:00+02:00","description":"A few weeks back, I wrote an article about how you can add Mermaid diagrams to your Markdown document. In this document, I will extend that technology and explain how you can add","headline":"Adding Diagrams to Markdown Documents","mainEntityOfPage":{"@type":"WebPage","@id":"https://javax0.github.io/2023/06/19/kroki-in-jamal.html"},"url":"https://javax0.github.io/2023/06/19/kroki-in-jamal.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://javax0.github.io/feed.xml" title="Java Deep, mostly Java" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Java Deep, mostly Java</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/about/">About</a><a class="page-link" href="/">Java Deep</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Adding Diagrams to Markdown Documents</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-06-19T00:00:00+02:00" itemprop="datePublished">Jun 19, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A few weeks back, I wrote an article about how you can add Mermaid diagrams to your Markdown document.
In this document, I will extend that technology and explain how you can add</p>
</div>
<div class="literalblock">
<div class="content">
<pre>BlockDiag  BPMN️  Bytefield️  SeqDiag  ActDiag  NwDiag  PacketDiag  RackDiag
C4 with PlantUML  D2  DBML  Ditaa  Erd Excalidraw️  GraphViz  Mermaid  Nomnoml
Pikchr️  PlantUML  Structurizr  Svgbob  TikZ  UMlet  Vega  Vega-Lite  WaveDrom
WireViz</pre>
</div>
</div>
<div class="paragraph">
<p>To your markdown, Asciidoc, or any other document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="1-problem-statement">1. Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The problem statement is the same as in the previous article.
You want diagrams in your document, but the formatting tool does not support the diagramming tool you want to use.
It is an architectural problem that cannot be solved until we combine the different responsibilities: formatting and information content management.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="2-approach-to-solve-the-problem">2. Approach to Solve the problem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The approach is the same again; I am talking about the same tool.</p>
</div>
<div class="paragraph">
<p>The basic idea is, again: the separation of concerns.
The document markup language should be responsible for the document structure and content.
The diagramming tool should be responsible for the diagramming.
The meta markup should be responsible for the integration of the two.
I will not repeat here all the arguments why this is a good idea.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="3-suggested-solution-tools">3. Suggested Solution, Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The suggested solution is to use Jamal as the meta markup.
However, this time we will not use Mermaid as a diagramming tool locally.
Instead, we will enjoy the services of the diagramming tool Kroki.</p>
</div>
<div class="sect2">
<h3 id="3-1-what-is-kroki">3.1. What is Kroki</h3>
<div class="paragraph">
<p>Kroki is a simple tool, and it is as genial as simple as the idea is.
It is nothing else than a web service implementing one <code>GET</code> endpoint to execute 27 different diagramming tools.
If you</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create your diagram text</p>
</li>
<li>
<p>convert the text to base64 encoded</p>
</li>
<li>
<p>open the URL <code><a href="https://kroki.io/&lt;tool&gt;/&lt;format&gt;/&lt;base64" class="bare">https://kroki.io/&lt;tool&gt;/&lt;format&gt;/&lt;base64</a> encoded text&gt;</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>then you will get the diagram in the format you requested.</p>
</div>
<div class="paragraph">
<p>Brilliant.</p>
</div>
<div class="paragraph">
<p>If you develop something for open source, you can use Kroki for free.
If you develop something secret, afraid that your secret gets out to the internet, you can start Kroki on-premise.
Kroki is available as a docker image and also in other modes.
I recommend Docker if you do not trust the public service.</p>
</div>
<div class="paragraph">
<p>Why do we need Jamal?</p>
</div>
<div class="paragraph">
<p>Well, what happens if the service is temporarily not available?
Why should you pull the image all the time from the internet?</p>
</div>
</div>
<div class="sect2">
<h3 id="3-2-need-for-jamal">3.2. Need for Jamal</h3>
<div class="paragraph">
<p>After the first few iterations of editing the diagram file, converting it to base64, and opening the URL, you will realize that it is simple but repetitive work.
Precisely the type of work that should be automatized.
And that is what Jamal is for.</p>
</div>
<div class="paragraph">
<p>The next release of Jamal 2.3.0 will come with a new macro, including a file that you can import as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-jamal" data-lang="jamal">{@import res:kroki.jim}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It defines a macro <code>kroki</code> that you can use to include the diagram in your document.</p>
</div>
<div class="paragraph">
<p>The beauty of this solution is that the implementation did not need any Kroki-specific Java code.
It was all already there.
The macros used in that file are available from <a href="https://raw.githubusercontent.com/verhas/jamal/master/jamal-snippet/src/main/resources/kroki.jim">github</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-jamal" data-lang="jamal">{@comment }
define the macro kroki to download the image from kroki.io and reference it either Asciidoc or Markdown syntax

{@define [tail] kroki($name,$dt,$ft,$x)={#if /{#string:equals/md.jam/{#file (format="$extension2") {@pos (top format=%f)}}}/![]({kroki:download |$name|$dt|$ft|$x})/image::{kroki:download |$name|$dt|$ft|$x}[]}}

{@define kroki:download($name,$dt,$ft,$x)={#define URL={kroki:url|$dt|$ft|$x}}\
{#memoize (file="$name.$ft" hashFile="$name.$ft.hash" hashCode="{#hashCode {URL}}")
{@ident {#download (file="$name.$ft") {URL}}}}$name.$ft}

{@define kroki:url($dt,$ft,$x)=https://kroki.io/$dt/$ft/{@base64 (compress url)$x}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The macros check whether the included file is <code>md.jam</code> (Markdown) or not; based on that, it generates a Markdown image reference or Asciidoc.
It also checks if the diagram has been downloaded and changed since the last time it was edited.
It downloads the diagram only if it has changed since the last time it was generated.
To do that, it uses the general purpose <code>memoize</code>, <code>download</code>, <code>file</code>, and <code>hashCode</code> macros.</p>
</div>
<div class="paragraph">
<p>This tooling also allows you to use variables in the diagram text.
Whether the diagram supports arithmetical, macro, or string operations does not matter.
Jamal provides it before the diagram text is sent to Kroki.</p>
</div>
<div class="paragraph">
<p>If you want to see some excellent examples, please visit the sample pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/verhas/jamal/blob/master/jamal-snippet/KROKI.md.jam" class="bare">https://github.com/verhas/jamal/blob/master/jamal-snippet/KROKI.md.jam</a></p>
</li>
<li>
<p><a href="https://github.com/verhas/jamal/blob/master/jamal-snippet/KROKI.adoc.jam" class="bare">https://github.com/verhas/jamal/blob/master/jamal-snippet/KROKI.adoc.jam</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the URL without the <code>.jam</code> at the end to see the GitHub-rendered versions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="4-summary-and-takeaway">4. Summary and Takeaway</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This article discussed integrating 27 diagram types into your Asciidoc, Markdown, or any other markup document.
There is no excuse anymore for any outdated diagram.</p>
</div>
</div>
</div>


<!-- Disqus comments section goes here (if comments are enabled) -->

<hr/>
<h1>Comments</h1>
<p>Please leave your comments using Disqus, or just press one of the happy faces.
If for any reason you do not want to leave a comment here, <a href="https://github.com/javax0/javax0.github.io/issues">you can still create a Github ticket</a>.</p>
<div class="comments">
    <div id="disqus_thread"></div>

    <script type="text/javascript">

        /* * * STOP! * * */
        /* You shouldn't need to edit ANYTHING below to get this working! */
        /* Instead, edit the key `disqus.shortname` in _config.yml */

        var disqus_config = function (){
            this.page.url = 'https://javax0.github.io/2023/06/19/kroki-in-jamal.html';
            this.page.identifier = '/2023/06/19/kroki-in-jamal.html';
        };

        (function() {
            var d = document, s = d.createElement('script');
            s.type = 'text/javascript'; s.async = true;
            s.src = 'https://javax0.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();

    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>




  </div><a class="u-url" href="/2023/06/19/kroki-in-jamal.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java Deep, mostly Java</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java Deep, mostly Java</li><li><a class="u-email" href="mailto:peter@verhas.com">peter@verhas.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/verhas"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">verhas</span></a></li><li><a href="https://www.twitter.com/verhas"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">verhas</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>javax0 is a technical Java oriented blog. Whenever I find something interesting, in the mood and feel the power to publish it, you will get it here. Publications are usually released on Wednesday 15:00am GMT. Earlier posts of the blog were published on Javax0 Wordpress Site at https://javax0.wordpress.com</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
